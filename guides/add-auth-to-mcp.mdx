---
title: "Add Civic Auth to Your MCP Server in 15 Minutes"
description: "A Practical Guide for Startups"
---

## Table of Contents

- [Summary](#summary)
- [Background](#background)
- [Setup](#setup)
- [Step 1: Install Dependencies](#step-1-install-dependencies)
- [Step 2: Set Up the MCP Server](#step-2-set-up-the-mcp-server)
- [Step 3: Register an MCP Tool](#step-3-register-an-mcp-tool)
- [Step 4: Expose Your Server with a Transport Layer](#step-4-expose-your-server-with-a-transport-layer)
- [Adding the transport to your app](#adding-the-transport-to-your-app)
- [Step 4: Time for Auth](#step-4-time-for-auth)
- [Advanced Features and Configuration](#advanced-features-and-configuration)
- [What if I'm not using Express?](#what-if-im-not-using-express)
- [What's next?](#whats-next)

---

## Summary

This guide walks through how to add Civic Auth to your MCP server with the `auth-mcp` library.

---

## Background

You've probably already heard about MCP (Model Context Protocol), the groundbreaking standard that allows LLMs to actually get things done in the real world. But when you start moving your MCP server out of your local dev environment and onto the web, you quickly hit a snag: **authentication**. After all, when your server lives online, you can't just let anybody use it.

In this guide, we‚Äôll show you how to create an MCP server from scratch, host it alongside your existing web APIs, and secure it using Civic Auth.

---

## Setup

Let's say you already have a working Express-based Todo app. The backend exposes basic functionality like adding and listing todos. You're getting user information from an auth header, likely containing a session ID or JWT, using a helper function `extractFromAuthHeader`. You also have a simple service layer that manages the actual data.

Here‚Äôs what your `app.ts` might look like:

```ts
import express from "express";
const app = express();

app.use(express.json());

app.get("/todo", (req, res) => {
  const userId = extractFromAuthHeader(req);
  const todos = service.getTodos(userId);
  res.json(todos);
});

app.post("/todo", (req, res) => {
  const userId = extractFromAuthHeader(req);
  const todo = service.createTodo(userId, req.body);
  res.status(201).json(todo);
});

app.listen(3000, () => console.log("Todo app listening on port 3000"));
```

---

## Step 1: Install Dependencies

Start by installing the libraries you'll need:

```bash
npm install @modelcontextprotocol/sdk @civic/auth-mcp
```

---

## Step 2: Set Up the MCP Server

Import what you'll need:

```ts
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp";
```

Create the MCP server instance:

```ts
const mcpServer = new McpServer({
  name: "todo-mcp-server",
  version: "0.0.1",
});
```

---

## Step 3: Register an MCP Tool

Register a tool to list todos:

```ts
mcpServer.tool(
  "list-todos",
  "List your current todos",
  {},
  async (_, extra) => {
    const userId = "placeholder-user"; // We'll hook up auth later
    const todos = service.getTodos(userId);
    return {
      content: [{ type: "text", text: JSON.stringify(todos) }],
    };
  }
);
```

Register a tool to add todos:

```ts
mcpServer.tool(
  "add-todo",
  "Add a new todo item",
  {
    text: z.string().describe("The content of the todo item"),
  },
  async (input, extra) => {
    const userId = "placeholder-user";
    const newTodo = service.createTodo(userId, { text: input.text });
    return {
      content: [{ type: "text", text: `Created todo: ${newTodo.text}` }],
    };
  }
);
```

> **Note**: Use descriptive names and parameter descriptions to help the LLM understand your tools.

---

## Step 4: Expose Your Server with a Transport Layer

Import and configure the HTTP transport:

```ts
import { StreamableHTTPServerTransport } from "@modelcontextprotocol/sdk/server/streamableHttp";

const transport = new StreamableHTTPServerTransport({
  sessionIdGenerator: undefined,
});
```

> **What is Streamable HTTP?**\
> Streamable HTTP allows progressive responses, ideal for AI tools needing streaming capabilities without persistent connections.

---

## Adding the transport to your app

Define the MCP server per request:

```ts
async function getServer() {
  const server = new McpServer(...);
  // Register tools here
  const transport = ...;
  await server.connect(transport);
  return { transport, server };
}
```

Add an MCP route:

```ts
app.post("/mcp", async (req, res) => {
  const { transport, server } = await getServer();
  await transport.handleRequest(req, res, req.body);
  res.on("close", () => {
    transport.close();
    server.close();
  });
});
```

> **Why per-request servers?**\
> The MCP SDK encourages stateless sessions. Creating new server instances per request ensures clean isolation.

You can test your server with:

```bash
npx @modelcontextprotocol/inspector
```

Use ‚ÄúStreamable HTTP‚Äù and your app‚Äôs URL.

---

## Step 4: Time for Auth

Replace placeholder user logic with real authentication:

```ts
import { auth } from "@civic/auth-mcp";
app.use(await auth());
```

Now, in your tool definitions, replace:

```ts
const userId = extra.authInfo?.extra?.sub;
```

> **What is Civic Auth?**\
> Civic Auth is a developer-friendly OAuth2/OIDC-based solution for AI-ready, privacy-preserving authentication.\
> Learn more: [civic.com/auth](https://www.civic.com/auth) | [docs.civic.com/auth](https://docs.civic.com/auth)

---

## Advanced Features and Configuration

Use custom auth providers:

```ts
app.use(await auth({
  wellKnownUrl: "https://accounts.google.com/.well-known/openid-configuration"
}));
```

---

## What if I'm not using Express?

The `@civic/auth-mcp` library is framework-agnostic and works with any Node-based server.\
Refer to the [framework-agnostic guide](https://docs.civic.com/auth) for details.

---

## What's next?

MCP is transitioning from local to hosted environments. Civic Auth is the first step toward safely sharing your tools with the world.

Client support is evolving‚Äîif you're building in this space, explore `@civic/auth-mcp`'s client utilities and contribute\!

---

## Need help?

- üí¨ [Join the conversation on Discord](https://www.civic.com/discord)
- üê¶ [Follow us on Twitter/X](https://twitter.com/civickey)
- üíº [Connect on LinkedIn](https://www.linkedin.com/company/civic-technologies)