---
title: Vercel AI SDK Integration
description: Build AI applications using Civic Nexus with Vercel AI SDK
icon: "triangle"
---

## Overview

Integrate Civic Nexus with Vercel AI SDK to build AI applications that can access external tools and services through MCP (Model Context Protocol). This enables your AI agents to interact with GitHub, Slack, Dropbox, and other connected services.

<Note>
**Updated for AI SDK v5**: This guide has been updated to use Vercel AI SDK v5. The main changes from v4 include:
- New tool definition format with `execute` functions
- Updated streaming response methods (`toDataStreamResponse()` instead of `toAIStreamResponse()`)
- Improved error handling and type safety
- App Router examples instead of Pages Router
</Note>

<Note>
**Prerequisites:** You'll need a Civic account and Node.js 18+ installed. [Create your account](https://nexus.civic.com) and select your tools first.
</Note>

## Installation

Install the required packages:

```bash
npm install ai @ai-sdk/openai @ai-sdk/anthropic @modelcontextprotocol/sdk @civic/auth
```

<Note>
**AI SDK v5**: This guide uses the latest Vercel AI SDK v5, which includes significant improvements and breaking changes from v4. Make sure to use v5 for the best experience.
</Note>

<CardGroup cols={2}>
  <Card title="Vercel AI SDK v5" icon="brain">
    Latest AI SDK for building AI applications
  </Card>
  <Card title="Model Providers" icon="robot">
    OpenAI and Anthropic provider packages
  </Card>
  <Card title="MCP SDK" icon="plug">
    Provides HTTP client transport for MCP protocol
  </Card>
  <Card title="Civic Auth" icon="shield-check">
    Handles authentication with Civic Nexus
  </Card>
</CardGroup>

## Basic Setup

### Step 1: Create MCP Client

Create a function to initialize the MCP client with authentication:

```typescript
import { StreamableHTTPClientTransport } from '@modelcontextprotocol/sdk/client/streamableHttp.js';
import { Client } from '@modelcontextprotocol/sdk/client/index.js';
import { getTokens } from "@civic/auth/nextjs";

const createMCPClient = async () => {
  // Get access token from Civic Auth
  const { accessToken } = await getTokens();
  
  if (!accessToken) {
    throw new Error('No access token available. User needs to authenticate.');
  }

  // Create transport with authentication
  const transport = new StreamableHTTPClientTransport(
    'https://nexus.civic.com/hub/mcp',
    {
      requestInit: {
        headers: {
          Authorization: `Bearer ${accessToken}`,
          'Content-Type': 'application/json'
        }
      }
    }
  );

  // Initialize MCP client
  const client = new Client({
    name: 'my-ai-app',
    version: '1.0.0'
  }, {
    capabilities: {}
  });

  await client.connect(transport);
  return client;
};
```

### Step 2: List Available Tools

Query available MCP tools from your connected services:

```typescript
const listAvailableTools = async () => {
  const client = await createMCPClient();
  
  try {
    const tools = await client.listTools();
    console.log('Available tools:', tools.tools);
    return tools.tools;
  } catch (error) {
    console.error('Failed to list tools:', error);
    throw error;
  } finally {
    await client.close();
  }
};
```

### Step 3: Call MCP Tools

Execute tools with the MCP client:

```typescript
const callMCPTool = async (toolName: string, arguments: Record<string, any>) => {
  const client = await createMCPClient();
  
  try {
    const result = await client.callTool({
      name: toolName,
      arguments
    });
    
    return result.content;
  } catch (error) {
    console.error(`Failed to call tool ${toolName}:`, error);
    throw error;
  } finally {
    await client.close();
  }
};
```

## Integration with Vercel AI SDK

### Using with OpenAI

Combine MCP tools with OpenAI's function calling:

```typescript
import { openai } from '@ai-sdk/openai';
import { generateText } from 'ai';

const generateWithMCPTools = async (prompt: string) => {
  // Get available MCP tools
  const client = await createMCPClient();
  const { tools } = await client.listTools();
  
  // Convert MCP tools to AI SDK v5 tool format
  const aiTools = tools.reduce((acc, tool) => {
    acc[tool.name] = {
      description: tool.description,
      parameters: tool.inputSchema,
      execute: async (args: any) => {
        // Execute MCP tool when called
        return await callMCPTool(tool.name, args);
      }
    };
    return acc;
  }, {} as Record<string, any>);

  const result = await generateText({
    model: openai('gpt-4'),
    prompt,
    tools: aiTools,
  });

  await client.close();
  return result;
};
```

### Using with Anthropic Claude

```typescript
import { anthropic } from '@ai-sdk/anthropic';
import { generateText } from 'ai';

const generateWithClaude = async (prompt: string) => {
  const client = await createMCPClient();
  const { tools } = await client.listTools();
  
  // Convert MCP tools to AI SDK v5 tool format
  const aiTools = tools.reduce((acc, tool) => {
    acc[tool.name] = {
      description: tool.description,
      parameters: tool.inputSchema,
      execute: async (args: any) => {
        // Execute MCP tool when called
        return await callMCPTool(tool.name, args);
      }
    };
    return acc;
  }, {} as Record<string, any>);

  const result = await generateText({
    model: anthropic('claude-3-5-sonnet-20241022'),
    prompt,
    tools: aiTools,
  });

  await client.close();
  return result;
};
```

## Complete Example: AI Assistant

Here's a complete example showing how to authenticate with Nexus and integrate MCP tools:

```typescript
// app/api/chat/route.ts (Next.js App Router API route)
import { NextRequest } from 'next/server';
import { openai } from '@ai-sdk/openai';
import { streamText } from 'ai';
import { StreamableHTTPClientTransport } from '@modelcontextprotocol/sdk/client/streamableHttp.js';
import { Client } from '@modelcontextprotocol/sdk/client/index.js';
import { getTokens } from "@civic/auth/nextjs";

async function createMCPClient() {
  // Get Civic Auth token for Nexus authentication
  const { accessToken } = await getTokens();
  
  // Create MCP transport with Nexus authentication headers
  const transport = new StreamableHTTPClientTransport(
    'https://nexus.civic.com/hub/mcp',
    {
      requestInit: {
        headers: {
          // Required: Bearer token for Nexus authentication
          Authorization: `Bearer ${accessToken}`,
          'Content-Type': 'application/json'
        }
      }
    }
  );

  const client = new Client({
    name: 'my-ai-app',
    version: '1.0.0'
  }, {
    capabilities: {}
  });

  await client.connect(transport);
  return client;
}

export async function POST(req: NextRequest) {
  const { messages } = await req.json();
  
  // Connect to Nexus MCP Hub
  const client = await createMCPClient();
  const { tools } = await client.listTools();
  
  // Convert MCP tools to AI SDK v5 format
  const aiTools = tools.reduce((acc, tool) => {
    acc[tool.name] = {
      description: tool.description,
      parameters: tool.inputSchema,
      execute: async (args: any) => {
        const result = await client.callTool({
          name: tool.name,
          arguments: args
        });
        return result.content;
      }
    };
    return acc;
  }, {} as Record<string, any>);

  const result = await streamText({
    model: openai('gpt-4'),
    messages,
    tools: aiTools,
  });

  await client.close();
  return result.toDataStreamResponse();
}
```

## Nexus Authentication

The key to integrating with Nexus is properly setting up the authentication headers. Here's what you need:

<AccordionGroup>
  <Accordion title="Required Headers">
    ```typescript
    headers: {
      // Required: Bearer token from Civic Auth
      Authorization: `Bearer ${accessToken}`,
      'Content-Type': 'application/json'
    }
    ```
  </Accordion>
  
  <Accordion title="Getting the Access Token">
    Use Civic Auth to get the user's access token:
    ```typescript
    import { getTokens } from "@civic/auth/nextjs";
    const { accessToken } = await getTokens();
    ```
  </Accordion>
  
  <Accordion title="Nexus Endpoint">
    Always connect to the Nexus MCP Hub endpoint:
    ```
    https://nexus.civic.com/hub/mcp
    ```
  </Accordion>
</AccordionGroup>

## Next Steps

<Steps>
  <Step title="Set up Authentication">
    Configure Civic Auth in your Next.js application following our [auth guide](/integration/nextjs)
  </Step>
  
  <Step title="Connect Services">
    Visit [nexus.civic.com](https://nexus.civic.com) to connect GitHub, Slack, or other services
  </Step>
  
  <Step title="Build Your AI App">
    Use the examples above to create your AI-powered application
  </Step>
  
  <Step title="Deploy">
    Deploy to Vercel or your preferred platform with proper environment variables
  </Step>
</Steps>

<Card title="Need Help?" icon="message-circle" href="https://civickey.typeform.com/to/uVH7CWJ5">
  Contact our team for technical support and implementation assistance
</Card>
