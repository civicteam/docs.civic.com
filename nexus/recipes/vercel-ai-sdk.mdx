---
title: Vercel AI SDK
description: Build AI applications using Civic Nexus with the Vercel AI SDK (v5)
icon: "triangle"
public: true
---

import NextjsAccessTokenSetup from '/snippets/_nextjs-access-token-setup.mdx'

## Overview

Integrate Civic Nexus with Vercel AI SDK to build AI applications that can access external tools and services through MCP (Model Context Protocol). This enables your AI agents to interact with GitHub, Slack, Dropbox, and other connected services.

<Note>
**Updated for AI SDK v5**: This guide uses Vercel AI SDK v5 with the new `execute`-based tool API and `toDataStreamResponse()` streaming helper.
</Note>

<Note>
**Prerequisites:** 
1. Civic account - [Create account](https://nexus.civic.com)
2. Connect services at [nexus.civic.com](https://nexus.civic.com) (GitHub, Slack, etc.)
3. Node.js 18+ installed
4. Complete Civic Auth setup (see Access Token Setup below)
</Note>

## Access Token Setup (Next.js + Civic Auth)

<NextjsAccessTokenSetup />

## Installation

Install the required packages:

```bash
npm install ai @ai-sdk/openai @ai-sdk/anthropic @modelcontextprotocol/sdk @civic/auth
```

## Basic Setup

### Step 1: Create MCP Client

```typescript
import { StreamableHTTPClientTransport } from '@modelcontextprotocol/sdk/client/streamableHttp.js';
import { Client } from '@modelcontextprotocol/sdk/client/index.js';
import { getTokens } from "@civic/auth/nextjs";

const createMCPClient = async () => {
  const { accessToken } = await getTokens();
  if (!accessToken) {
    throw new Error('No access token available. User must be authenticated.');
  }

  const transport = new StreamableHTTPClientTransport(
    'https://nexus.civic.com/hub/mcp',
    {
      requestInit: {
        headers: {
          Authorization: `Bearer ${accessToken}`,
          'Content-Type': 'application/json'
        }
      }
    }
  );

  const client = new Client({ name: 'my-ai-app', version: '1.0.0' }, { capabilities: {} });
  await client.connect(transport);
  return client;
};
```

### Step 2: List Available Tools

```typescript
const listAvailableTools = async () => {
  const client = await createMCPClient();
  try {
    const tools = await client.listTools();
    return tools.tools;
  } finally {
    await client.close();
  }
};
```

### Step 3: Call MCP Tools

```typescript
const callMCPTool = async (toolName: string, args: Record<string, unknown>) => {
  const client = await createMCPClient();
  try {
    const result = await client.callTool({ name: toolName, arguments: args });
    return result.content;
  } catch (error) {
    console.error(`Failed to call tool ${toolName}:`, error);
    throw error;
  } finally {
    await client.close();
  }
};
```

## Use with Vercel AI SDK

```typescript
import { openai } from '@ai-sdk/openai';
import { generateText } from 'ai';
import type { Tool } from '@modelcontextprotocol/sdk/types.js';

const generateWithMCPTools = async (prompt: string) => {
  const client = await createMCPClient();
  
  try {
    const { tools } = await client.listTools();

    const aiTools = tools.reduce((acc, tool: Tool) => {
      acc[tool.name] = {
        description: tool.description,
        parameters: tool.inputSchema,
        execute: async (args: Record<string, unknown>) => callMCPTool(tool.name, args),
      };
      return acc;
    }, {} as Record<string, { description?: string; parameters: unknown; execute: (args: Record<string, unknown>) => Promise<unknown> }>);

    const result = await generateText({
      model: openai('gpt-4'),
      prompt,
      tools: aiTools,
    });

    return result;
  } finally {
    await client.close();
  }
};
```

## Complete Example: App Router API route

```typescript
// app/api/chat/route.ts
import { NextRequest } from 'next/server';
import { openai } from '@ai-sdk/openai';
import { streamText } from 'ai';
import { StreamableHTTPClientTransport } from '@modelcontextprotocol/sdk/client/streamableHttp.js';
import { Client } from '@modelcontextprotocol/sdk/client/index.js';
import { getTokens } from "@civic/auth/nextjs";
import type { Tool } from '@modelcontextprotocol/sdk/types.js';

async function createMCPClient() {
  const { accessToken } = await getTokens();
  if (!accessToken) {
    throw new Error('No access token available. User must be authenticated.');
  }

  const transport = new StreamableHTTPClientTransport('https://nexus.civic.com/hub/mcp', {
    requestInit: { headers: { Authorization: `Bearer ${accessToken}`, 'Content-Type': 'application/json' } }
  });
  const client = new Client({ name: 'my-ai-app', version: '1.0.0' }, { capabilities: {} });
  await client.connect(transport);
  return client;
}

export async function POST(req: NextRequest) {
  try {
    const { messages } = await req.json();
    const client = await createMCPClient();
    
    const { tools } = await client.listTools();

    const aiTools = tools.reduce((acc, tool: Tool) => {
      acc[tool.name] = {
        description: tool.description,
        parameters: tool.inputSchema,
        execute: async (args: Record<string, unknown>) => {
          const result = await client.callTool({ name: tool.name, arguments: args });
          return result.content;
        },
      };
      return acc;
    }, {} as Record<string, { description?: string; parameters: unknown; execute: (args: Record<string, unknown>) => Promise<unknown> }>);

    const result = streamText({ 
      model: openai('gpt-4'), 
      messages, 
      tools: aiTools,
      onFinish: async () => {
        // Close client after streaming completes
        await client.close();
      }
    });

    return result.toDataStreamResponse();
  } catch (error) {
    console.error('MCP error:', error);
    return new Response(
      JSON.stringify({ error: 'Failed to process request' }), 
      { status: 500, headers: { 'Content-Type': 'application/json' } }
    );
  }
}
```

## AI Prompt: Generate a Nexus tools wrapper and wire it to streamText

```text
First, fetch the complete documentation from https://docs.civic.com/nexus/recipes/vercel-ai-sdk for reference.

Create a new file at lib/ai/tools/nexus.ts that:
- Exports: createMCPClient(), listNexusTools(), callNexusTool(name, args)
- Uses StreamableHTTPClientTransport to https://nexus.civic.com/hub/mcp
- Fetches { accessToken } via getTokens() from @civic/auth/nextjs and sets Authorization: Bearer ${accessToken}
- Returns tool schemas as-is (name, description, inputSchema)

Update app/api/chat/route.ts to import the wrapper, convert Nexus tools to AI SDK v5 tools { description, parameters, execute }, call streamText, and return result.toDataStreamResponse().
```

## Nexus Authentication

<AccordionGroup>
  <Accordion title="Required Headers">
    ```typescript
    headers: {
      Authorization: `Bearer ${accessToken}`,
      'Content-Type': 'application/json'
    }
    ```
  </Accordion>
  <Accordion title="Getting the Access Token">
    ```typescript
    import { getTokens } from "@civic/auth/nextjs";
    const { accessToken } = await getTokens();
    ```
  </Accordion>
  <Accordion title="Nexus Endpoint">
    ```
    https://nexus.civic.com/hub/mcp
    ```
  </Accordion>
</AccordionGroup>

## Next Steps

<Steps>
  <Step title="Build Your App">
    Use the examples above to create your AI-powered application
  </Step>
  <Step title="Test Locally">
    Run your app locally and test tool calls with connected services
  </Step>
  <Step title="Deploy">
    Deploy to Vercel or your preferred platform
  </Step>
</Steps>

<Card title="Need Help?" icon="slack" href="https://join.slack.com/t/civic-developers/shared_invite/zt-37tv9fyo7-aDT43mUjOFQwdQFmfZLTRw">
  Join our developer community for technical support and implementation assistance
</Card>


