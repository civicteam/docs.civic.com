---
title: Vercel AI SDK
description: Build AI applications using Civic Nexus with the Vercel AI SDK (v5)
icon: "triangle"
public: true
---

import NextjsAccessTokenSetup from '/snippets/_nextjs-access-token-setup.mdx'

## Overview

Build AI applications with Civic Nexus and Vercel AI SDK v5. Your AI agents can access external tools and services through MCP (Model Context Protocol) - interact with GitHub, Slack, Dropbox, and more.

<Note>
**Framework:** This guide is written for Next.js projects. The core MCP client setup works with any JavaScript framework, but authentication setup uses Next.js-specific APIs.
</Note>

## Quick Start

The fastest way to get started is with our starter template:

<Card title="AI Chatbot Starter" icon="github" href="https://github.com/civicteam/ai-chatbot">
  Clone our Next.js + Vercel AI SDK template with Nexus pre-configured. Includes authentication, streaming, and tool calling out of the box.
</Card>

```bash
git clone https://github.com/civicteam/ai-chatbot.git
cd ai-chatbot
pnpm install

# Copy the example env file and add your keys
cp .env.example .env.local
# Edit .env.local with your CIVIC_AUTH_CLIENT_ID and AI provider keys

#make sure you have docker installed for the database
docker-compose up -d

#run the database migrations
pnpm run db:migrate

pnpm run dev
```

<Accordion title="Required Environment Variables">
  ```bash
  CIVIC_AUTH_CLIENT_ID=your_client_id_here
  OPENAI_API_KEY=your_openai_key  # or ANTHROPIC_API_KEY
  ```
  Get your Civic Client ID at [auth.civic.com](https://auth.civic.com)
</Accordion>

<Note>
**Updated for AI SDK v5**: This guide uses Vercel AI SDK v5 with `convertToCoreMessages()` for message handling and `toUIMessageStreamResponse()` for streaming compatibility with `@ai-sdk/react`.
</Note>

## Build From Scratch

Want to integrate Nexus into an existing Next.js project? Follow the guide below.


<Note>
**Prerequisites:**
1. **Next.js 14+ project** with App Router (Pages Router also supported)
2. Civic account - [Create account](https://nexus.civic.com)
3. Connect services at [nexus.civic.com](https://nexus.civic.com) (GitHub, Slack, etc.)
4. Node.js 18+ installed
5. Complete Civic Auth setup (see Access Token Setup below)
</Note>

## Access Token Setup (Next.js + Civic Auth)

<NextjsAccessTokenSetup />

### Environment Variables

Create a `.env.local` file in your project root:

```bash
# Civic Auth
CIVIC_AUTH_CLIENT_ID=your_client_id_here

# AI Gateway (works with OpenAI, Anthropic, and other providers)
AI_GATEWAY_API_KEY=your_vercel_ai_gateway_key
```

<Note>
**Getting your API keys:**
1. **Civic Client ID**: Visit [auth.civic.com](https://auth.civic.com), create a new application, and copy the Client ID
2. **AI Gateway API Key**: Visit [vercel.com/ai-gateway](https://vercel.com/ai-gateway) to get one API key that works with OpenAI, Anthropic, and other providers
</Note>

## Installation

Install the required packages:

```bash
pnpm install ai @ai-sdk/openai @ai-sdk/anthropic @ai-sdk/react @modelcontextprotocol/sdk @civic/auth
```

## Basic Setup

### Create Nexus Tools Helper

```typescript
import { StreamableHTTPClientTransport } from '@modelcontextprotocol/sdk/client/streamableHttp.js';
import { getTokens } from "@civic/auth/nextjs";
import { experimental_createMCPClient as createMCPClient } from "ai";

export const getNexusTools = async () => {
  const { accessToken } = (await getTokens()) ?? {};
  if (!accessToken) {
    // Return empty tools if no access token (Nexus is optional)
    return {};
  }

  try {
    const transport = new StreamableHTTPClientTransport(
      new URL('https://nexus.civic.com/hub/mcp'), {
        requestInit: {
          headers: {
            Authorization: `Bearer ${accessToken}`
          }
        }
      }
    );

    const mcpClient = await createMCPClient({ transport });
    return mcpClient.tools();
  } catch (error) {
    console.warn('Failed to load Nexus tools, continuing without them:', error);
    return {};
  }
}
```

## Complete Example: App Router API route

```typescript
// app/api/chat/route.ts
import { convertToCoreMessages, streamText } from 'ai';
import { openai } from '@ai-sdk/openai';
import { getNexusTools } from '@/lib/ai/tools/nexus';

export async function POST(request: Request) {
  try {
    const { messages } = await request.json();

    if (!messages || !Array.isArray(messages)) {
      return new Response(
        JSON.stringify({ error: 'Invalid request: messages array required' }),
        { status: 400, headers: { 'Content-Type': 'application/json' } }
      );
    }

    // Convert UI messages to core messages
    const coreMessages = convertToCoreMessages(messages);

    // Get Nexus tools
    const nexusTools = await getNexusTools();

    const result = streamText({
      model: openai('gpt-4o'),
      messages: coreMessages,
      tools: nexusTools,
    });

    // Use toUIMessageStreamResponse() for @ai-sdk/react compatibility
    return result.toUIMessageStreamResponse();
  } catch (error) {
    console.error('Chat error:', error);
    const errorMessage = error instanceof Error ? error.message : 'Failed to process request';

    return new Response(
      JSON.stringify({ error: errorMessage }),
      { status: 500, headers: { 'Content-Type': 'application/json' } }
    );
  }
}
```

<Note>
**Using Anthropic/Claude?** Replace the model with:
```typescript
import { anthropic } from '@ai-sdk/anthropic';

const result = streamText({
  model: anthropic('claude-sonnet-4-5-20250929'),
  messages: coreMessages,
  tools: nexusTools,
});
```
</Note>

## Nexus Authentication

<AccordionGroup>
  <Accordion title="Required Headers">
    ```typescript
    headers: {
      Authorization: `Bearer ${accessToken}`,
      'Content-Type': 'application/json'
    }
    ```
  </Accordion>
  <Accordion title="Getting the Access Token">
    ```typescript
    import { getTokens } from "@civic/auth/nextjs";
    const { accessToken } = await getTokens();
    ```
  </Accordion>
  <Accordion title="Nexus Endpoint">
    ```
    https://nexus.civic.com/hub/mcp
    ```
  </Accordion>
</AccordionGroup>

## Next Steps

<Steps>
  <Step title="Try the Starter Template">
    Clone [ai-chatbot](https://github.com/civicteam/ai-chatbot) for a working example with UI, authentication, and streaming
  </Step>
  <Step title="Connect Your Services">
    Visit [nexus.civic.com](https://nexus.civic.com) to connect GitHub, Slack, Notion, and other services
  </Step>
  <Step title="Test Tool Calls">
    Run locally and ask your AI to "list my GitHub repos" or "search Slack messages"
  </Step>
  <Step title="Deploy to Production">
    Deploy to Vercel with one click - all environment variables are pre-configured
  </Step>
</Steps>

<CardGroup cols={2}>
  <Card title="Starter Template" icon="github" href="https://github.com/civicteam/ai-chatbot">
    Full Next.js + Vercel AI SDK example with Nexus integration
  </Card>
  <Card title="Need Help?" icon="slack" href="https://join.slack.com/t/civic-developers/shared_invite/zt-37tv9fyo7-aDT43mUjOFQwdQFmfZLTRw">
    Join our developer community for technical support
  </Card>
</CardGroup>


