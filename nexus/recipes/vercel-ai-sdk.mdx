---
title: Vercel AI SDK
description: Build AI applications using Civic Nexus with the Vercel AI SDK (v5)
icon: "triangle"
public: true
---

import NextjsAccessTokenSetup from '/snippets/_nextjs-access-token-setup.mdx'

## Overview

Build AI applications with Civic Nexus and Vercel AI SDK v5. Your AI agents can access external tools and services through MCP (Model Context Protocol) - interact with GitHub, Slack, Dropbox, and more.

<Note>
**Framework:** This guide is written for Next.js projects. The core MCP client setup works with any JavaScript framework, but authentication setup uses Next.js-specific APIs.
</Note>

## Quick Start

The fastest way to get started is with our starter template:

<Card title="AI Chatbot Starter" icon="github" href="https://github.com/civicteam/ai-chatbot">
  Clone our Next.js + Vercel AI SDK template with Nexus pre-configured. Includes authentication, streaming, and tool calling out of the box.
</Card>

```bash
git clone https://github.com/civicteam/ai-chatbot.git
cd ai-chatbot
npm install

# Copy the example env file and add your keys
cp .env.example .env.local
# Edit .env.local with your CIVIC_AUTH_CLIENT_ID and AI provider keys

npm run dev
```

<Accordion title="Required Environment Variables">
  ```bash
  CIVIC_AUTH_CLIENT_ID=your_client_id_here
  OPENAI_API_KEY=your_openai_key  # or ANTHROPIC_API_KEY
  ```
  Get your Civic Client ID at [auth.civic.com](https://auth.civic.com)
</Accordion>

<Note>
**Updated for AI SDK v5**: This guide uses Vercel AI SDK v5 with the new `execute`-based tool API and `toDataStreamResponse()` streaming helper.
</Note>

## Build From Scratch

Want to integrate Nexus into an existing Next.js project? Follow the guide below.

<Tip>
**Prefer AI-assisted setup?** Use our [AI prompt](/nexus/ai-prompts/vercel-ai-sdk) with Claude, ChatGPT, or Cursor to automatically generate this integration code for you.
</Tip>

<Note>
**Prerequisites:**
1. **Next.js 13+ project** with App Router (Pages Router also supported)
2. Civic account - [Create account](https://nexus.civic.com)
3. Connect services at [nexus.civic.com](https://nexus.civic.com) (GitHub, Slack, etc.)
4. Node.js 18+ installed
5. Complete Civic Auth setup (see Access Token Setup below)
</Note>

## Access Token Setup (Next.js + Civic Auth)

<NextjsAccessTokenSetup />

### Environment Variables

Create a `.env.local` file in your project root:

```bash
# Get your Client ID at https://auth.civic.com
CIVIC_AUTH_CLIENT_ID=your_client_id_here

# Optional: AI Provider API keys (choose one or more)
OPENAI_API_KEY=your_openai_key
ANTHROPIC_API_KEY=your_anthropic_key
```

<Note>
**Getting your Civic Client ID:**
1. Visit [auth.civic.com](https://auth.civic.com)
2. Create a new application or use an existing one
3. Copy the Client ID from your application settings
</Note>

## Installation

Install the required packages:

```bash
npm install ai @ai-sdk/openai @ai-sdk/anthropic @modelcontextprotocol/sdk @civic/auth
```

## Basic Setup

### Step 1: Create MCP Client

```typescript
import { StreamableHTTPClientTransport } from '@modelcontextprotocol/sdk/client/streamableHttp.js';
import { Client } from '@modelcontextprotocol/sdk/client/index.js';
import { getTokens } from "@civic/auth/nextjs";

const createMCPClient = async () => {
  const { accessToken } = await getTokens();
  if (!accessToken) {
    throw new Error('No access token available. User must be authenticated.');
  }

  const transport = new StreamableHTTPClientTransport(
    'https://nexus.civic.com/hub/mcp',
    {
      requestInit: {
        headers: {
          Authorization: `Bearer ${accessToken}`,
          'Content-Type': 'application/json'
        }
      }
    }
  );

  const client = new Client({ name: 'my-ai-app', version: '1.0.0' }, { capabilities: {} });
  await client.connect(transport);
  return client;
};
```

### Step 2: List Available Tools

```typescript
const listAvailableTools = async () => {
  const client = await createMCPClient();
  try {
    const tools = await client.listTools();
    return tools.tools;
  } finally {
    await client.close();
  }
};
```

### Step 3: Call MCP Tools

```typescript
const callMCPTool = async (toolName: string, args: Record<string, unknown>) => {
  const client = await createMCPClient();
  try {
    const result = await client.callTool({ name: toolName, arguments: args });
    return result.content;
  } catch (error) {
    console.error(`Failed to call tool ${toolName}:`, error);
    throw error;
  } finally {
    await client.close();
  }
};
```

## Use with Vercel AI SDK

```typescript
import { openai } from '@ai-sdk/openai';
import { generateText } from 'ai';
import type { Tool } from '@modelcontextprotocol/sdk/types.js';

const generateWithMCPTools = async (prompt: string) => {
  const client = await createMCPClient();
  
  try {
    const { tools } = await client.listTools();

    const aiTools = tools.reduce((acc, tool: Tool) => {
      acc[tool.name] = {
        description: tool.description,
        parameters: tool.inputSchema,
        execute: async (args: Record<string, unknown>) => callMCPTool(tool.name, args),
      };
      return acc;
    }, {} as Record<string, { description?: string; parameters: unknown; execute: (args: Record<string, unknown>) => Promise<unknown> }>);

    const result = await generateText({
      model: openai('gpt-4'),
      prompt,
      tools: aiTools,
    });

    return result;
  } finally {
    await client.close();
  }
};
```

## Complete Example: App Router API route

```typescript
// app/api/chat/route.ts
import { NextRequest } from 'next/server';
import { openai } from '@ai-sdk/openai';
import { streamText } from 'ai';
import { StreamableHTTPClientTransport } from '@modelcontextprotocol/sdk/client/streamableHttp.js';
import { Client } from '@modelcontextprotocol/sdk/client/index.js';
import { getTokens } from "@civic/auth/nextjs";
import type { Tool } from '@modelcontextprotocol/sdk/types.js';

async function createMCPClient() {
  const { accessToken } = await getTokens();
  if (!accessToken) {
    throw new Error('No access token available. User must be authenticated.');
  }

  const transport = new StreamableHTTPClientTransport('https://nexus.civic.com/hub/mcp', {
    requestInit: { headers: { Authorization: `Bearer ${accessToken}`, 'Content-Type': 'application/json' } }
  });
  const client = new Client({ name: 'my-ai-app', version: '1.0.0' }, { capabilities: {} });
  await client.connect(transport);
  return client;
}

export async function POST(req: NextRequest) {
  let client: Client | null = null;

  try {
    const { messages } = await req.json();

    if (!messages || !Array.isArray(messages)) {
      return new Response(
        JSON.stringify({ error: 'Invalid request: messages array required' }),
        { status: 400, headers: { 'Content-Type': 'application/json' } }
      );
    }

    client = await createMCPClient();
    const { tools } = await client.listTools();

    const aiTools = tools.reduce((acc, tool: Tool) => {
      acc[tool.name] = {
        description: tool.description,
        parameters: tool.inputSchema,
        execute: async (args: Record<string, unknown>) => {
          try {
            const result = await client!.callTool({ name: tool.name, arguments: args });
            return result.content;
          } catch (toolError) {
            console.error(`Tool execution failed for ${tool.name}:`, toolError);
            throw new Error(`Failed to execute tool: ${tool.name}`);
          }
        },
      };
      return acc;
    }, {} as Record<string, { description?: string; parameters: unknown; execute: (args: Record<string, unknown>) => Promise<unknown> }>);

    const result = streamText({
      model: openai('gpt-4'),
      messages,
      tools: aiTools,
      onFinish: async () => {
        // Close client after streaming completes
        if (client) {
          await client.close();
        }
      }
    });

    return result.toDataStreamResponse();
  } catch (error) {
    // Ensure client is closed on error
    if (client) {
      try {
        await client.close();
      } catch (closeError) {
        console.error('Error closing MCP client:', closeError);
      }
    }

    console.error('MCP error:', error);
    const errorMessage = error instanceof Error ? error.message : 'Failed to process request';
    const statusCode = errorMessage.includes('No access token') ? 401 : 500;

    return new Response(
      JSON.stringify({ error: errorMessage }),
      { status: statusCode, headers: { 'Content-Type': 'application/json' } }
    );
  }
}
```

## AI-Assisted Integration

<Card title="Use AI to Set This Up" icon="robot" href="/nexus/ai-prompts/vercel-ai-sdk">
  Let Claude, ChatGPT, or Cursor automatically generate this integration code for you. Just copy the prompt and paste it into your AI assistant.
</Card>

## Nexus Authentication

<AccordionGroup>
  <Accordion title="Required Headers">
    ```typescript
    headers: {
      Authorization: `Bearer ${accessToken}`,
      'Content-Type': 'application/json'
    }
    ```
  </Accordion>
  <Accordion title="Getting the Access Token">
    ```typescript
    import { getTokens } from "@civic/auth/nextjs";
    const { accessToken } = await getTokens();
    ```
  </Accordion>
  <Accordion title="Nexus Endpoint">
    ```
    https://nexus.civic.com/hub/mcp
    ```
  </Accordion>
</AccordionGroup>

## Next Steps

<Steps>
  <Step title="Try the Starter Template">
    Clone [ai-chatbot](https://github.com/civicteam/ai-chatbot) for a working example with UI, authentication, and streaming
  </Step>
  <Step title="Connect Your Services">
    Visit [nexus.civic.com](https://nexus.civic.com) to connect GitHub, Slack, Notion, and other services
  </Step>
  <Step title="Test Tool Calls">
    Run locally and ask your AI to "list my GitHub repos" or "search Slack messages"
  </Step>
  <Step title="Deploy to Production">
    Deploy to Vercel with one click - all environment variables are pre-configured
  </Step>
</Steps>

<CardGroup cols={2}>
  <Card title="Starter Template" icon="github" href="https://github.com/civicteam/ai-chatbot">
    Full Next.js + Vercel AI SDK example with Nexus integration
  </Card>
  <Card title="Need Help?" icon="slack" href="https://join.slack.com/t/civic-developers/shared_invite/zt-37tv9fyo7-aDT43mUjOFQwdQFmfZLTRw">
    Join our developer community for technical support
  </Card>
</CardGroup>


