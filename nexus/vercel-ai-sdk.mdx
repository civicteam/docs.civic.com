---
title: Building Agents with Vercel AI SDK
description: Create intelligent agents using Vercel AI SDK with MCP servers in minutes
icon: "sparkles"
---

<Note>
  This guide shows how to build AI agents using Vercel AI SDK's experimental MCP server support. For other AI frameworks, see our [client compatibility guide](/nexus/reference/client-compatibility).
</Note>

## Prerequisites

Before you begin, make sure you have:

<CardGroup cols={2}>
  <Card title="Node.js & npm" icon="code" href="https://nodejs.org/">
    Node.js 18+ and npm installed on your machine
  </Card>
  <Card title="Civic Nexus Account" icon="user" href="https://ai.civic.com">
    Create a free account on ai.civic.com to access MCP servers
  </Card>
  <Card title="Vercel Account" icon="vercel" href="https://vercel.com">
    Sign up for Vercel to deploy your MCP servers
  </Card>
  <Card title="OpenAI API Key" icon="key" href="https://platform.openai.com/api-keys">
    Get your OpenAI API key for running AI models
  </Card>
</CardGroup>

## Architecture Overview

Here's how the components work together:

<img
  className="rounded-lg"
  src="https://placehold.co/1200x600/e0e7ff/6366f1?text=Vercel+AI+SDK+%2B+MCP+Architecture"
  alt="Vercel AI SDK with MCP architecture diagram"
/>

1. **MCP Servers**: Tools and data sources (deployed on Vercel or Civic Nexus)
2. **Vercel AI SDK**: Orchestrates AI models and tool calling
3. **Your Application**: The intelligent agent that uses both

## Step 1: Set up your Civic Nexus MCP servers

First, configure the MCP servers you want your agent to access:

<Steps>
  <Step title="Browse available MCP servers">
    Visit [ai.civic.com](https://ai.civic.com) and explore the directory of available MCP servers.
    
    <Tip>
      Popular servers for agent building include GitHub, Slack, Google Drive, and database connectors. Each server provides specific tools your agent can use.
    </Tip>
  </Step>

  <Step title="Select and configure servers">
    Choose the MCP servers you want to connect:
    1. Click the checkbox next to each server you want to use
    2. Complete any required authentication flows
    3. Copy the MCP URL that appears (e.g., `https://ai.civic.com/v1/mcp`)
    
    <img
      className="rounded-lg"
      src="https://placehold.co/800x400/e0e7ff/6366f1?text=Civic+MCP+Server+Selection"
      alt="Selecting MCP servers in Civic Nexus"
    />
  </Step>
</Steps>

## Step 2: Create your Vercel AI agent project

<Steps>
  <Step title="Initialize a new Next.js project">
    Create a new project with the required dependencies:
    
    ```bash
    npx create-next-app@latest my-ai-agent
    cd my-ai-agent
    npm install ai @ai-sdk/openai
    ```
  </Step>

  <Step title="Set up environment variables">
    Create a `.env.local` file with your API keys:
    
    ```bash
    OPENAI_API_KEY=your_openai_api_key_here
    CIVIC_MCP_URL=https://ai.civic.com/v1/mcp
    ```
    
    <Warning>
      Keep your API keys secure and never commit them to version control. Consider using Vercel's environment variables for production.
    </Warning>
  </Step>
</Steps>

## Step 3: Connect to MCP servers

Create an API route that connects to your Civic Nexus MCP servers:

<Steps>
  <Step title="Create the MCP client connection">
    Create `app/api/agent/route.js`:
    
    ```javascript
    import { experimental_createMCPClient as createMCPClient } from 'ai';
    import { generateText } from 'ai';
    import { openai } from '@ai-sdk/openai';

    export async function POST(request) {
      const { prompt } = await request.json();
      
      // Connect to Civic Nexus MCP servers
      const mcpClient = await createMCPClient({
        transport: {
          type: 'sse',
          url: process.env.CIVIC_MCP_URL,
          headers: {
            Authorization: `Bearer ${process.env.CIVIC_API_TOKEN}`, // If required
          },
        },
      });
      
      try {
        // Get available tools from MCP servers
        const tools = await mcpClient.tools();
        
        // Generate response using AI model with MCP tools
        const response = await generateText({
          model: openai('gpt-4'),
          tools,
          prompt,
          maxToolRoundtrips: 5, // Allow multiple tool calls
        });
        
        return Response.json({
          response: response.text,
          toolCalls: response.toolCalls,
        });
      } finally {
        // Always close the MCP client
        await mcpClient.close();
      }
    }
    ```
  </Step>

  <Step title="Create the frontend interface">
    Create `app/page.js` for interacting with your agent:
    
    ```javascript
    'use client';
    
    import { useState } from 'react';
    
    export default function HomePage() {
      const [prompt, setPrompt] = useState('');
      const [response, setResponse] = useState('');
      const [loading, setLoading] = useState(false);
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        
        try {
          const res = await fetch('/api/agent', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt }),
          });
          
          const data = await res.json();
          setResponse(data.response);
        } catch (error) {
          console.error('Error:', error);
          setResponse('Sorry, there was an error processing your request.');
        } finally {
          setLoading(false);
        }
      };
      
      return (
        <div className="max-w-4xl mx-auto p-6">
          <h1 className="text-3xl font-bold mb-6">AI Agent with MCP Tools</h1>
          
          <form onSubmit={handleSubmit} className="mb-6">
            <textarea
              value={prompt}
              onChange={(e) => setPrompt(e.target.value)}
              placeholder="Ask your agent something..."
              className="w-full p-3 border rounded-lg resize-none"
              rows={4}
            />
            <button
              type="submit"
              disabled={loading}
              className="mt-2 px-6 py-2 bg-blue-600 text-white rounded-lg disabled:opacity-50"
            >
              {loading ? 'Processing...' : 'Send'}
            </button>
          </form>
          
          {response && (
            <div className="p-4 bg-gray-50 rounded-lg">
              <h3 className="font-semibold mb-2">Agent Response:</h3>
              <p className="whitespace-pre-wrap">{response}</p>
            </div>
          )}
        </div>
      );
    }
    ```
  </Step>
</Steps>

## Step 4: Advanced agent patterns

<Steps>
  <Step title="Streaming responses">
    For real-time interactions, use streaming:
    
    ```javascript
    import { streamText } from 'ai';
    
    export async function POST(request) {
      const { prompt } = await request.json();
      
      const mcpClient = await createMCPClient({
        transport: {
          type: 'sse',
          url: process.env.CIVIC_MCP_URL,
        },
      });
      
      const tools = await mcpClient.tools();
      
      const result = await streamText({
        model: openai('gpt-4'),
        tools,
        prompt,
        onFinish: async () => {
          await mcpClient.close();
        },
      });
      
      return result.toDataStreamResponse();
    }
    ```
  </Step>

  <Step title="Multi-step workflows">
    Create agents that can plan and execute complex workflows:
    
    ```javascript
    const response = await generateText({
      model: openai('gpt-4'),
      tools,
      prompt: `
        I need you to:
        1. Check my recent Slack messages
        2. Summarize any urgent items
        3. Create a GitHub issue for any bugs mentioned
        4. Send a summary email to my team
        
        User request: ${prompt}
      `,
      maxToolRoundtrips: 10, // Allow complex workflows
    });
    ```
  </Step>
</Steps>

## Step 5: Deploy and test

<Steps>
  <Step title="Deploy to Vercel">
    Deploy your agent to Vercel:
    
    ```bash
    npm run build
    vercel --prod
    ```
    
    Don't forget to add your environment variables in the Vercel dashboard.
  </Step>

  <Step title="Test your agent">
    Try these example prompts to test your agent's capabilities:
    
    - **Data query**: "What are my top 5 GitHub repositories by stars?"
    - **Workflow**: "Send a Slack message to #engineering about today's deployment"
    - **Analysis**: "Analyze my recent Google Drive documents and summarize key points"
    - **Integration**: "Create a calendar event for tomorrow's standup and invite the team"
  </Step>
</Steps>

## Example use cases

<AccordionGroup>
  <Accordion title="Customer Support Agent" icon="headset">
    Build an agent that can:
    - Query your knowledge base
    - Check customer history in CRM
    - Create support tickets
    - Send follow-up emails
    
    ```javascript
    const prompt = `
      A customer is asking about their order status. 
      Please check their order history and provide an update.
      Customer email: ${customerEmail}
    `;
    ```
  </Accordion>
  
  <Accordion title="DevOps Assistant" icon="server">
    Create an agent that can:
    - Monitor application health
    - Deploy code changes
    - Manage infrastructure
    - Send alerts to teams
    
    ```javascript
    const prompt = `
      Check the status of our production services and 
      alert the team if anything needs attention.
    `;
    ```
  </Accordion>
  
  <Accordion title="Sales Intelligence Agent" icon="chart-line">
    Build an agent that can:
    - Analyze sales pipeline
    - Research prospects
    - Update CRM records
    - Generate reports
    
    ```javascript
    const prompt = `
      Prepare a sales report for this week, including
      pipeline updates and next actions for each deal.
    `;
    ```
  </Accordion>
</AccordionGroup>

## Best practices

<CardGroup cols={2}>
  <Card title="Error handling" icon="shield-exclamation">
    Always wrap MCP calls in try-catch blocks and handle authentication errors gracefully.
  </Card>
  
  <Card title="Resource management" icon="cpu">
    Close MCP clients properly to avoid memory leaks, especially in streaming scenarios.
  </Card>
  
  <Card title="Rate limiting" icon="gauge">
    Implement rate limiting for your agent API to prevent abuse and manage costs.
  </Card>
  
  <Card title="Security" icon="lock">
    Never expose API keys in frontend code. Use server-side APIs and environment variables.
  </Card>
</CardGroup>

## Troubleshooting

<AccordionGroup>
  <Accordion title="MCP connection fails">
    Check that:
    - Your Civic Nexus MCP URL is correct
    - You have selected MCP servers in your Civic dashboard
    - Your authentication tokens are valid
    - The MCP servers you're trying to use are properly configured
  </Accordion>
  
  <Accordion title="Tools not available">
    Ensure that:
    - You've completed authentication for the required services
    - The MCP servers are running and accessible
    - Your account has access to the selected MCP servers
  </Accordion>
  
  <Accordion title="Performance issues">
    Consider:
    - Reducing the number of MCP servers connected simultaneously
    - Implementing caching for frequently used data
    - Using streaming for long-running operations
    - Optimizing your prompts to reduce token usage
  </Accordion>
</AccordionGroup>

## Next steps

<CardGroup cols={2}>
  <Card title="Advanced patterns" icon="gear" href="/nexus/recipes/agent-patterns">
    Learn advanced agent design patterns and workflows
  </Card>
  
  <Card title="Custom MCP servers" icon="code" href="/nexus/developers/mcp-integration">
    Build your own MCP servers for custom integrations
  </Card>
  
  <Card title="Production deployment" icon="rocket" href="/nexus/recipes/production-deployment">
    Scale your agents for production workloads
  </Card>
  
  <Card title="Security guide" icon="shield-check" href="/nexus/security/overview">
    Implement enterprise-grade security for your agents
  </Card>
</CardGroup>
